{"version":3,"sources":["../../../src/components/interactive-map.js"],"names":["PureComponent","createElement","createContext","createRef","PropTypes","StaticMap","MAPBOX_LIMITS","WebMercatorViewport","TransitionManager","EventManager","MapController","deprecateWarn","InteractiveContext","eventManager","isDragging","propTypes","Object","assign","maxZoom","number","minZoom","maxPitch","minPitch","onViewStateChange","func","onViewportChange","onInteractionStateChange","transitionDuration","transitionInterpolator","object","transitionInterruption","transitionEasing","onTransitionStart","onTransitionInterrupt","onTransitionEnd","scrollZoom","bool","dragPan","dragRotate","doubleClickZoom","touchZoom","touchRotate","keyboard","onHover","onClick","onDblClick","onContextMenu","onMouseDown","onMouseMove","onMouseUp","onTouchStart","onTouchMove","onTouchEnd","onMouseEnter","onMouseLeave","onMouseOut","onWheel","touchAction","string","clickRadius","interactiveLayerIds","array","getCursor","controller","instanceOf","getDefaultCursor","isHovering","defaultProps","event","preventDefault","InteractiveMap","supported","props","isLoaded","_staticMapRef","current","getMap","geometry","options","map","queryRenderedFeatures","interactionState","state","setState","width","height","_width","_height","_setControllerProps","onResize","viewState","oldViewState","onLoad","callbackName","_normalizeEvent","pointerType","_onEvent","features","_getFeatures","pos","point","radius","Boolean","length","isEntering","isExiting","_controller","_eventManager","_updateInteractiveContext","setElement","_eventCanvasRef","on","pointerdown","_onPointerDown","pointermove","_onPointerMove","pointerup","_onPointerUp","pointerleave","bind","click","_onClick","dblclick","wheel","contextmenu","nextProps","nextState","isInteractive","_onViewportChange","onStateChange","_onInteractionStateChange","setOptions","queryParams","layers","size","bbox","updatedContext","_interactiveContext","lngLat","offsetCenter","x","y","viewport","unproject","style","eventCanvasStyle","position","cursor","Provider","value","key","ref","_onResize","_onLoad","children"],"mappings":"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","sourcesContent":["// @flow\nimport {PureComponent, createElement, createContext, createRef} from 'react';\nimport PropTypes from 'prop-types';\n\nimport StaticMap from './static-map';\nimport {MAPBOX_LIMITS} from '../utils/map-state';\nimport WebMercatorViewport from 'viewport-mercator-project';\n\nimport TransitionManager from '../utils/transition-manager';\n\nimport {EventManager} from 'mjolnir.js';\nimport MapController from '../utils/map-controller';\nimport deprecateWarn from '../utils/deprecate-warn';\n\nimport type {ViewState} from '../mapbox/mapbox';\nimport type {StaticMapProps} from './static-map';\nimport type {MjolnirEvent} from 'mjolnir.js';\n\nexport const InteractiveContext = createContext({\n  eventManager: null,\n  isDragging: false\n});\n\nconst propTypes = Object.assign({}, StaticMap.propTypes, {\n  // Additional props on top of StaticMap\n\n  /** Viewport constraints */\n  // Max zoom level\n  maxZoom: PropTypes.number,\n  // Min zoom level\n  minZoom: PropTypes.number,\n  // Max pitch in degrees\n  maxPitch: PropTypes.number,\n  // Min pitch in degrees\n  minPitch: PropTypes.number,\n\n  // Callbacks fired when the user interacted with the map. The object passed to the callbacks\n  // contains viewport properties such as `longitude`, `latitude`, `zoom` etc.\n  onViewStateChange: PropTypes.func,\n  onViewportChange: PropTypes.func,\n  onInteractionStateChange: PropTypes.func,\n\n  /** Viewport transition **/\n  // transition duration for viewport change\n  transitionDuration: PropTypes.number,\n  // TransitionInterpolator instance, can be used to perform custom transitions.\n  transitionInterpolator: PropTypes.object,\n  // type of interruption of current transition on update.\n  transitionInterruption: PropTypes.number,\n  // easing function\n  transitionEasing: PropTypes.func,\n  // transition status update functions\n  onTransitionStart: PropTypes.func,\n  onTransitionInterrupt: PropTypes.func,\n  onTransitionEnd: PropTypes.func,\n\n  /** Enables control event handling */\n  // Scroll to zoom\n  scrollZoom: PropTypes.bool,\n  // Drag to pan\n  dragPan: PropTypes.bool,\n  // Drag to rotate\n  dragRotate: PropTypes.bool,\n  // Double click to zoom\n  doubleClickZoom: PropTypes.bool,\n  // Multitouch zoom\n  touchZoom: PropTypes.bool,\n  // Multitouch rotate\n  touchRotate: PropTypes.bool,\n  // Keyboard\n  keyboard: PropTypes.bool,\n\n  /** Event callbacks */\n  onHover: PropTypes.func,\n  onClick: PropTypes.func,\n  onDblClick: PropTypes.func,\n  onContextMenu: PropTypes.func,\n  onMouseDown: PropTypes.func,\n  onMouseMove: PropTypes.func,\n  onMouseUp: PropTypes.func,\n  onTouchStart: PropTypes.func,\n  onTouchMove: PropTypes.func,\n  onTouchEnd: PropTypes.func,\n  onMouseEnter: PropTypes.func,\n  onMouseLeave: PropTypes.func,\n  onMouseOut: PropTypes.func,\n  onWheel: PropTypes.func,\n\n  /** Custom touch-action CSS for the event canvas. Defaults to 'none' */\n  touchAction: PropTypes.string,\n\n  /** Radius to detect features around a clicked point. Defaults to 0. */\n  clickRadius: PropTypes.number,\n\n  /** List of layers that are interactive */\n  interactiveLayerIds: PropTypes.array,\n\n  /** Accessor that returns a cursor style to show interactive state */\n  getCursor: PropTypes.func,\n\n  // A map control instance to replace the default map controller\n  // The object must expose a method: `setOptions(opts)`\n  controller: PropTypes.instanceOf(MapController)\n});\n\nconst getDefaultCursor = ({isDragging, isHovering}) => isDragging ?\n  'grabbing' :\n  (isHovering ? 'pointer' : 'grab');\n\nconst defaultProps = Object.assign({},\n  StaticMap.defaultProps, MAPBOX_LIMITS, TransitionManager.defaultProps,\n  {\n    onViewStateChange: null,\n    onViewportChange: null,\n    onClick: null,\n    onHover: null,\n    onContextMenu: event => event.preventDefault(),\n\n    scrollZoom: true,\n    dragPan: true,\n    dragRotate: true,\n    doubleClickZoom: true,\n    touchZoom: true,\n    touchRotate: false,\n    keyboard: true,\n\n    touchAction: 'none',\n    clickRadius: 0,\n    getCursor: getDefaultCursor\n  }\n);\n\ntype InteractionState = {\n  isDragging: boolean,\n};\n\ntype MapEvent = MjolnirEvent & {\n  point: Array<number>,\n  lngLat: Array<number>,\n  features: ?Array<any>\n};\n\ntype InteractiveMapProps = StaticMapProps & {\n  onViewStateChange: Function,\n  onViewportChange: Function,\n  onInteractionStateChange: Function,\n  onHover: Function,\n  onClick: Function,\n  onDblClick: Function,\n  onContextMenu: Function,\n  onMouseDown: Function,\n  onMouseMove: Function,\n  onMouseUp: Function,\n  onTouchStart: Function,\n  onTouchMove: Function,\n  onTouchEnd: Function,\n  onMouseEnter: Function,\n  onMouseLeave: Function,\n  onMouseOut: Function,\n  onWheel: Function,\n  touchAction: string,\n  clickRadius: number,\n  interactiveLayerIds: Array<string>,\n  getCursor: Function,\n  controller: MapController\n};\n\ntype State = {\n  isLoaded: boolean,\n  isDragging: boolean,\n  isHovering: boolean\n};\n\ntype InteractiveContextProps = {\n  isDragging: boolean,\n  eventManager: any\n};\n\nexport default class InteractiveMap extends PureComponent<InteractiveMapProps, State> {\n\n  static supported() {\n    return StaticMap.supported();\n  }\n\n  static propTypes = propTypes;\n  static defaultProps = defaultProps;\n\n  constructor(props : InteractiveMapProps) {\n    super(props);\n    // Check for deprecated props\n    deprecateWarn(props);\n\n    // If props.controller is not provided, fallback to default MapController instance\n    // Cannot use defaultProps here because it needs to be per map instance\n    this._controller = props.controller || new MapController();\n\n    this._eventManager = new EventManager(null, {\n      touchAction: props.touchAction\n    });\n\n    this._updateInteractiveContext({\n      isDragging: false,\n      eventManager: this._eventManager\n    });\n  }\n\n  state : State = {\n    // Whether mapbox styles have finished loading\n    isLoaded: false,\n    // Whether the cursor is down\n    isDragging: false,\n    // Whether the cursor is over a clickable feature\n    isHovering: false\n  };\n\n  componentDidMount() {\n    const eventManager = this._eventManager;\n\n    eventManager.setElement(this._eventCanvasRef.current);\n    // Register additional event handlers for click and hover\n    eventManager.on({\n      pointerdown: this._onPointerDown,\n      pointermove: this._onPointerMove,\n      pointerup: this._onPointerUp,\n      pointerleave: this._onEvent.bind(this, 'onMouseOut'),\n      click: this._onClick,\n      dblclick: this._onEvent.bind(this, 'onDblClick'),\n      wheel: this._onEvent.bind(this, 'onWheel'),\n      contextmenu: this._onEvent.bind(this, 'onContextMenu')\n    });\n\n    this._setControllerProps(this.props);\n  }\n\n  componentWillUpdate(nextProps : InteractiveMapProps, nextState : State) {\n    this._setControllerProps(nextProps);\n\n    if (nextState.isDragging !== this.state.isDragging) {\n      this._updateInteractiveContext({isDragging: nextState.isDragging});\n    }\n  }\n\n  _controller : MapController;\n  _eventManager : any;\n  _interactiveContext : InteractiveContextProps;\n  _width : number = 0;\n  _height : number = 0;\n  _eventCanvasRef: { current: null | HTMLDivElement } = createRef();\n  _staticMapRef: { current: null | StaticMap } = createRef();\n\n  getMap = () => {\n    return this._staticMapRef.current ? this._staticMapRef.current.getMap() : null;\n  }\n\n  queryRenderedFeatures = (geometry : any, options : any = {}) => {\n    const map = this.getMap();\n    return map && map.queryRenderedFeatures(geometry, options);\n  }\n\n  _setControllerProps(props : InteractiveMapProps) {\n    props = Object.assign({}, props, props.viewState, {\n      isInteractive: Boolean(props.onViewStateChange || props.onViewportChange),\n      onViewportChange: this._onViewportChange,\n      onStateChange: this._onInteractionStateChange,\n      eventManager: this._eventManager,\n      width: this._width,\n      height: this._height\n    });\n\n    this._controller.setOptions(props);\n  }\n\n  _getFeatures({pos, radius} : {pos : Array<number>, radius : number}) {\n    let features;\n    const queryParams = {};\n    const map = this.getMap();\n\n    if (this.props.interactiveLayerIds) {\n      queryParams.layers = this.props.interactiveLayerIds;\n    }\n\n    if (radius) {\n      // Radius enables point features, like marker symbols, to be clicked.\n      const size = radius;\n      const bbox = [[pos[0] - size, pos[1] + size], [pos[0] + size, pos[1] - size]];\n      features = map && map.queryRenderedFeatures(bbox, queryParams);\n    } else {\n      features = map && map.queryRenderedFeatures(pos, queryParams);\n    }\n    return features;\n  }\n\n  _onInteractionStateChange = (interactionState : InteractionState) => {\n    const {isDragging = false} = interactionState;\n    if (isDragging !== this.state.isDragging) {\n      this.setState({isDragging});\n    }\n\n    const {onInteractionStateChange} = this.props;\n    if (onInteractionStateChange) {\n      onInteractionStateChange(interactionState);\n    }\n  }\n\n  _updateInteractiveContext(updatedContext : $Shape<InteractiveContextProps>) {\n    this._interactiveContext = Object.assign({}, this._interactiveContext, updatedContext);\n  }\n\n  _onResize = ({width, height} : {width : number, height : number}) => {\n    this._width = width;\n    this._height = height;\n    this._setControllerProps(this.props);\n    this.props.onResize({width, height});\n  }\n\n  _onViewportChange = (\n    viewState : ViewState,\n    interactionState : InteractionState,\n    oldViewState : ViewState\n  ) => {\n    const {onViewStateChange, onViewportChange} = this.props;\n\n    if (onViewStateChange) {\n      onViewStateChange({viewState, interactionState, oldViewState});\n    }\n    if (onViewportChange) {\n      onViewportChange(viewState, interactionState, oldViewState);\n    }\n  }\n\n  /* Generic event handling */\n  _normalizeEvent(event : MapEvent) {\n    if (event.lngLat) {\n      // Already unprojected\n      return event;\n    }\n\n    const {offsetCenter: {x, y}} = event;\n    const pos = [x, y];\n\n    // $FlowFixMe\n    const viewport = new WebMercatorViewport(Object.assign({}, this.props, {\n      width: this._width,\n      height: this._height\n    }));\n\n    event.point = pos;\n    event.lngLat = viewport.unproject(pos);\n\n    return event;\n  }\n\n  _onLoad = (event : MapEvent) => {\n    this.setState({isLoaded: true});\n    this.props.onLoad(event);\n  }\n\n  _onEvent = (callbackName : string, event : MapEvent) => {\n    const func = this.props[callbackName];\n    if (func) {\n      func(this._normalizeEvent(event));\n    }\n  }\n\n  /* Special case event handling */\n  _onPointerDown = (event : MapEvent) => {\n    switch (event.pointerType) {\n    case 'touch':\n      this._onEvent('onTouchStart', event);\n      break;\n\n    default:\n      this._onEvent('onMouseDown', event);\n    }\n  }\n\n  _onPointerUp = (event : MapEvent) => {\n    switch (event.pointerType) {\n    case 'touch':\n      this._onEvent('onTouchEnd', event);\n      break;\n\n    default:\n      this._onEvent('onMouseUp', event);\n    }\n  }\n\n  _onPointerMove = (event : MapEvent) => {\n    switch (event.pointerType) {\n    case 'touch':\n      this._onEvent('onTouchMove', event);\n      break;\n\n    default:\n      this._onEvent('onMouseMove', event);\n    }\n\n    if (!this.state.isDragging) {\n      const {onHover, interactiveLayerIds} = this.props;\n      let features;\n      event = this._normalizeEvent(event);\n      if (this.state.isLoaded && (interactiveLayerIds || onHover)) {\n        features = this._getFeatures({pos: event.point, radius: this.props.clickRadius});\n      }\n      if (onHover) {\n        // backward compatibility: v3 `onHover` interface\n        event.features = features;\n        onHover(event);\n      }\n\n      const isHovering = Boolean(interactiveLayerIds && features && features.length > 0);\n      const isEntering = isHovering && !this.state.isHovering;\n      const isExiting = !isHovering && this.state.isHovering;\n\n      if (isEntering) {\n        this._onEvent('onMouseEnter', event);\n      }\n      if (isExiting) {\n        this._onEvent('onMouseLeave', event);\n      }\n      if (isEntering || isExiting) {\n        this.setState({isHovering});\n      }\n    }\n  }\n\n  _onClick = (event : MapEvent) => {\n    if (this.props.onClick) {\n      event = this._normalizeEvent(event);\n      // backward compatibility: v3 `onClick` interface\n      event.features = this._getFeatures({pos: event.point, radius: this.props.clickRadius});\n      this.props.onClick(event);\n    }\n  }\n\n  render() {\n    const {width, height, style, getCursor} = this.props;\n\n    const eventCanvasStyle = Object.assign({position: 'relative'}, style, {\n      width,\n      height,\n      cursor: getCursor(this.state)\n    });\n\n    return createElement(InteractiveContext.Provider, {value: this._interactiveContext},\n      createElement('div', {\n        key: 'event-canvas',\n        ref: this._eventCanvasRef,\n        style: eventCanvasStyle\n      },\n        createElement(StaticMap, Object.assign({}, this.props,\n          {\n            width: '100%',\n            height: '100%',\n            style: null,\n            onResize: this._onResize,\n            onLoad: this._onLoad,\n            ref: this._staticMapRef,\n            children: this.props.children\n          }\n        ))\n      )\n    );\n  }\n}\n"],"file":"interactive-map.js"}