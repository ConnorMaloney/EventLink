{"version":3,"sources":["../../../src/components/popup.js"],"names":["createElement","createRef","PropTypes","BaseControl","getDynamicPosition","ANCHOR_POSITION","propTypes","Object","assign","className","string","longitude","number","isRequired","latitude","altitude","offsetLeft","offsetTop","tipSize","closeButton","bool","closeOnClick","anchor","oneOf","keys","dynamicPosition","sortByDepth","onClose","func","defaultProps","Popup","constructor","props","evt","captureClick","stopPropagation","target","_closeOnClick","_contentRef","componentDidMount","forceUpdate","_getPosition","x","y","viewport","_context","content","current","padding","width","height","selfWidth","clientWidth","selfHeight","clientHeight","_getContainerStyle","z","positionType","anchorPosition","style","position","left","top","transform","display","zIndex","Math","floor","_renderTip","key","borderWidth","_renderContent","children","onClick","eventManager","_onClick","ref","type","_render","project","containerStyle","_containerRef"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nimport {createElement, createRef} from 'react';\nimport PropTypes from 'prop-types';\nimport BaseControl from './base-control';\n\nimport {getDynamicPosition, ANCHOR_POSITION} from '../utils/dynamic-position';\n\nconst propTypes = Object.assign({}, BaseControl.propTypes, {\n  // Custom className\n  className: PropTypes.string,\n  // Longitude of the anchor point\n  longitude: PropTypes.number.isRequired,\n  // Latitude of the anchor point\n  latitude: PropTypes.number.isRequired,\n  // Altitude of the anchor point\n  altitude: PropTypes.number,\n  // Offset from the left\n  offsetLeft: PropTypes.number,\n  // Offset from the top\n  offsetTop: PropTypes.number,\n  // Size of the tip\n  tipSize: PropTypes.number,\n  // Whether to show close button\n  closeButton: PropTypes.bool,\n  // Whether to close on click\n  closeOnClick: PropTypes.bool,\n  // The popup's location relative to the coordinate\n  anchor: PropTypes.oneOf(Object.keys(ANCHOR_POSITION)),\n  // Whether the popup anchor should be auto-adjusted to fit within the container\n  dynamicPosition: PropTypes.bool,\n  // Whether popups should be sorted by depth. Useful when using multiple popups with tilted map.\n  sortByDepth: PropTypes.bool,\n  // Callback when component is closed\n  onClose: PropTypes.func\n});\n\nconst defaultProps = Object.assign({}, BaseControl.defaultProps, {\n  className: '',\n  altitude: 0,\n  offsetLeft: 0,\n  offsetTop: 0,\n  tipSize: 10,\n  anchor: 'bottom',\n  dynamicPosition: true,\n  sortByDepth: false,\n  closeButton: true,\n  closeOnClick: true,\n  onClose: () => {}\n});\n\n/*\n * PureComponent doesn't update when context changes.\n * The only way is to implement our own shouldComponentUpdate here. Considering\n * the parent component (StaticMap or InteractiveMap) is pure, and map re-render\n * is almost always triggered by a viewport change, we almost definitely need to\n * recalculate the popup's position when the parent re-renders.\n */\nexport default class Popup extends BaseControl {\n\n  static propTypes = propTypes;\n  static defaultProps = defaultProps;\n\n  constructor(props) {\n    super(props);\n\n    this._closeOnClick = false;\n    this._contentRef = createRef();\n  }\n\n  componentDidMount() {\n    super.componentDidMount();\n    // Container just got a size, re-calculate position\n    this.forceUpdate();\n  }\n\n  _getPosition(x, y) {\n    const {viewport} = this._context;\n    const {anchor, dynamicPosition, tipSize} = this.props;\n    const content = this._contentRef.current;\n\n    if (content) {\n      return dynamicPosition ? getDynamicPosition({\n        x, y, anchor,\n        padding: tipSize,\n        width: viewport.width,\n        height: viewport.height,\n        selfWidth: content.clientWidth,\n        selfHeight: content.clientHeight\n      }) : anchor;\n    }\n\n    return anchor;\n  }\n\n  _getContainerStyle(x, y, z, positionType) {\n    const {viewport} = this._context;\n    const {offsetLeft, offsetTop, sortByDepth} = this.props;\n    const anchorPosition = ANCHOR_POSITION[positionType];\n\n    const style = {\n      position: 'absolute',\n      left: x + offsetLeft,\n      top: y + offsetTop,\n      transform: `translate(${-anchorPosition.x * 100}%, ${-anchorPosition.y * 100}%)`\n    };\n\n    if (!sortByDepth) {\n      return style;\n    }\n    if (z > 1 || z < -1 || x < 0 || x > viewport.width || y < 0 || y > viewport.height) {\n      // clipped\n      style.display = 'none';\n    } else {\n      // use z-index to rearrange components\n      style.zIndex = Math.floor(((1 - z) / 2) * 100000);\n    }\n\n    return style;\n  }\n\n  _onClick = (evt) => {\n    if (this.props.captureClick) {\n      evt.stopPropagation();\n    }\n\n    if (this.props.closeOnClick || evt.target.className === 'mapboxgl-popup-close-button') {\n      this.props.onClose();\n    }\n  }\n\n  _renderTip(positionType) {\n    const {tipSize} = this.props;\n\n    return createElement('div', {\n      key: 'tip',\n      className: 'mapboxgl-popup-tip',\n      style: {borderWidth: tipSize}\n    });\n  }\n\n  _renderContent() {\n    const {closeButton, children} = this.props;\n    // If eventManager does not exist (using with static map), listen to React event\n    const onClick = this._context.eventManager ? null : this._onClick;\n\n    return createElement('div', {\n      key: 'content',\n      ref: this._contentRef,\n      className: 'mapboxgl-popup-content',\n      onClick\n    }, [\n      closeButton && createElement('button', {\n        key: 'close-button',\n        className: 'mapboxgl-popup-close-button',\n        type: 'button'\n      }, '×'),\n      children\n    ]);\n  }\n\n  _render() {\n    const {className, longitude, latitude, altitude} = this.props;\n\n    const [x, y, z] = this._context.viewport.project([longitude, latitude, altitude]);\n\n    const positionType = this._getPosition(x, y);\n    const containerStyle = this._getContainerStyle(x, y, z, positionType);\n\n    return createElement('div', {\n      className: `mapboxgl-popup mapboxgl-popup-anchor-${positionType} ${className}`,\n      style: containerStyle,\n      ref: this._containerRef\n    }, [\n      this._renderTip(positionType),\n      this._renderContent()\n    ]);\n  }\n\n}\n"],"file":"popup.js"}